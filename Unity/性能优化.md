# AOI概念

> 概念：兴趣范围，需要服务器同步的范围，只同步（玩家）感兴趣的范围（身边发生的）


广播类型：

1. 全服广播
2. 地图广播 （频率高，压力大）
3. 社交关系
4. 交互目标
5. 玩家自身 （严格上不算，玩家与服务器通信）


![1700708208059](image/性能优化/1700708208059.png)


假设100个同时移动，需要通知所有人

1次 需要 100 * 100 = 10000次

1s同步10次

总 1s = 100 00 0 次

（MMO可以低点，FPS 同步次数要求高）

带宽限制、包转发率等问题


使用AOI 来处理，降低压力消耗，降低带宽，提高负载


根据不同游戏类型选择具体的解决方案。


## 方案1

区域划分-做距离计算

![1700709268550](image/性能优化/1700709268550.png)

级别设定

![1700709349829](image/性能优化/1700709349829.png)

![1700709422893](image/性能优化/1700709422893.png)

根据不同（距离或其他）级别，选择同步的内容


优点：易于实现，

缺点：计算成本高，O((1+N)*N/2) -> O(N^2)


改善方案：

1. 多线程（也要考虑切换线程消耗）
2. 延迟计算 （减少计算间隔）
3. 分批计算 （一帧算100个人）


根据CPU运算速度，网卡速度抉择方案


## 方案二

直接划分区域

![1700710862330](image/性能优化/1700710862330.png)

优点：计算块，O(N)

缺点：实现复杂

## 方案三

格子边界问题：划大格子范围


## 优化方向

成本高

算法优化 （四叉树，八叉树）

并行运算 GPU加速

ECS架构 -> （容易实现并行运算）


## 协调成本和性能



# 资源优化
